<div class="min-h-screen bg-[#0f172a] text-white pt-24 pb-20 px-4">
    <div class="max-w-3xl mx-auto">
        
        <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-800">
            <div>
                <h1 class="text-3xl font-bold text-white mb-1 flex items-center gap-3">
                    <i class='bx bx-bell text-sapereOrange'></i> Notificări
                </h1>
                <p class="text-gray-400 text-sm">Istoricul activităților și recompenselor tale.</p>
            </div>
            
            <% if (notifications.length > 0) { %>
            <button onclick="markAllRead()" class="flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition text-sm font-medium border border-gray-700">
                <i class='bx bx-check-double'></i> Marchează tot ca citit
            </button>
            <% } %>
        </div>

        <div class="space-y-4" id="notifications-list-page">
            <% if (notifications.length === 0) { %>
                <div class="flex flex-col items-center justify-center py-20 opacity-50 text-center">
                    <div class="w-20 h-20 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                        <i class='bx bx-bell-off text-4xl text-gray-500'></i>
                    </div>
                    <h3 class="text-lg font-bold text-white">Nu ai notificări</h3>
                    <p class="text-sm text-gray-500 max-w-xs mt-1">Ești la zi cu toate noutățile! Revino mai târziu.</p>
                </div>
            <% } else { %>
                <% notifications.forEach(n => { %>
                    <div class="group relative p-5 rounded-2xl border transition-all duration-300 <%= n.read ? 'border-gray-800 bg-gray-900/30 opacity-70' : 'border-gray-700 bg-[#1e293b] shadow-lg border-l-4 border-l-sapereOrange' %> hover:bg-[#1e293b] hover:opacity-100">
                        <div class="flex gap-4">
                            <!-- Icon -->
                            <div class="shrink-0 mt-1">
                                <% if(n.type === 'success' || n.type === 'reward') { %>
                                    <div class="w-10 h-10 rounded-full bg-green-500/10 flex items-center justify-center text-green-400 border border-green-500/20">
                                        <i class='bx bx-trophy text-xl'></i>
                                    </div>
                                <% } else if(n.type === 'error') { %>
                                    <div class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-400 border border-red-500/20">
                                        <i class='bx bx-x-circle text-xl'></i>
                                    </div>
                                <% } else { %>
                                    <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 border border-blue-500/20">
                                        <i class='bx bx-info-circle text-xl'></i>
                                    </div>
                                <% } %>
                            </div>

                            <!-- Content -->
                            <div class="flex-1">
                                <p class="text-gray-200 font-medium text-base leading-relaxed"><%= n.message %></p>
                                <span class="text-xs text-gray-500 mt-2 block flex items-center gap-1">
                                    <i class='bx bx-time'></i> <%= new Date(n.created_at).toLocaleString() %>
                                </span>
                            </div>

                            <!-- Action -->
                            <% if(!n.read) { %>
                                <button onclick="markRead('<%= n.id %>', this)" class="self-start text-gray-500 hover:text-sapereOrange transition p-2 hover:bg-white/5 rounded-full" title="Marchează ca citit">
                                    <i class='bx bxs-circle text-[10px] text-sapereOrange'></i>
                                </button>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            <% } %>
        </div>
    </div>
</div>

<script>
async function markRead(id, btn) {
    try {
        const res = await fetch('/notifications/api/read', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id })
        });
        if(res.ok) {
            // Animatie simpla de update
            const card = btn.closest('.group');
            card.classList.remove('border-l-4', 'border-l-sapereOrange', 'bg-[#1e293b]', 'shadow-lg');
            card.classList.add('border-gray-800', 'bg-gray-900/30', 'opacity-70');
            btn.remove();
            // Optional reload pentru a actualiza badge-ul din navbar
            // window.location.reload(); 
        }
    } catch(e) { console.error(e); }
}

async function markAllRead() {
    if(!confirm("Sigur vrei să marchezi totul ca citit?")) return;
    try {
        const res = await fetch('/notifications/api/read', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ id: 'all' })
        });
        if(res.ok) window.location.reload();
    } catch(e) { console.error(e); }
}
</script>