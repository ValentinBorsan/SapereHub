<div class="min-h-screen bg-[#0f172a] text-white pt-24 pb-20 px-4 sm:px-6">
  <div class="max-w-7xl mx-auto space-y-8">
    <div
      class="flex flex-col md:flex-row justify-between items-end gap-4 border-b border-gray-800 pb-6"
    >
      <div>
        <h1 class="text-3xl font-bold text-white mb-1">
          <%= __('profile.title') %>
        </h1>
        <p class="text-gray-400 text-sm"><%= __('profile.subtitle') %></p>
      </div>
      <% if (locals.success === 'updated') { %>
      <div role="alert" class="bg-green-500/10 border border-green-500/20 text-green-400 px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-bold animate-fade-in">
        <i class="bx bx-check-circle text-xl" aria-hidden="true"></i> <%=
        __('profile.success_update') %>
      </div>
      <% } %>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <div class="lg:col-span-4 space-y-6">
        <div
          class="bg-[#1e293b] rounded-2xl p-6 border border-gray-700 shadow-xl relative overflow-hidden group"
        >
          <div
            class="absolute top-0 right-0 w-32 h-32 bg-[#f59e0b]/10 blur-3xl rounded-full -mr-10 -mt-10 transition group-hover:bg-[#f59e0b]/20" aria-hidden="true"
          ></div>

          <div
            class="relative z-10 flex flex-col items-center text-center mb-8"
          >
            <div
              class="w-28 h-28 rounded-full bg-gradient-to-br from-[#f59e0b] to-orange-600 p-1 shadow-2xl mb-4"
            >
              <div
                class="w-full h-full rounded-full bg-[#1e293b] flex items-center justify-center text-4xl font-bold text-white"
              >
                <%= user.full_name ? user.full_name.charAt(0).toUpperCase() :
                'U' %>
              </div>
            </div>
            <h2 class="text-xl font-bold text-white"><%= user.full_name %></h2>
            <span
              class="px-3 py-1 mt-2 rounded-full bg-gray-700/50 border border-gray-600 text-xs font-bold uppercase tracking-wider text-gray-300"
            >
              <%= user.role === 'admin' ? __('profile.role.admin') :
              __('profile.role.student') %>
            </span>
          </div>

          <form action="/profile/update" method="POST" class="space-y-5">
            <div>
              <label for="profile-email" class="block text-xs font-bold text-gray-500 uppercase mb-1.5 ml-1"><%= __('profile.email') %></label>
              <input
                id="profile-email"
                type="text"
                value="<%= user.email %>"
                disabled
                class="w-full bg-[#0f172a] border border-gray-700 rounded-xl px-4 py-3 text-gray-400 cursor-not-allowed"
              />
            </div>
            <div>
              <label for="profile-fullname" class="block text-xs font-bold text-[#f59e0b] uppercase mb-1.5 ml-1"><%= __('profile.fullname') %></label>
              <input
                id="profile-fullname"
                type="text"
                name="full_name"
                value="<%= user.full_name %>"
                class="w-full bg-[#0f172a] border border-gray-600 rounded-xl px-4 py-3 text-white focus:border-[#f59e0b] outline-none"
              />
            </div>
            <button
              type="submit"
              class="w-full py-3 bg-white text-gray-900 font-bold rounded-xl hover:bg-gray-200 transition shadow-lg flex items-center justify-center gap-2 focus:outline-none focus:ring-2 focus:ring-gray-300"
            >
              <i class="bx bx-save" aria-hidden="true"></i> <%= __('profile.btn_save') %>
            </button>
          </form>
        </div>
      </div>

      <div class="lg:col-span-8 space-y-6">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div
            class="bg-[#1e293b] p-6 rounded-2xl border border-gray-700 flex flex-col items-center justify-center relative overflow-hidden group hover:border-[#f59e0b]/50 transition"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition" aria-hidden="true"
            >
              <i class="bx bx-trophy text-6xl text-[#f59e0b]"></i>
            </div>
            <span
              id="profile-xp-value"
              class="text-4xl font-black text-[#f59e0b] mb-1"
              ><%= user.xp || 0 %></span
            >
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest"
              ><%= __('profile.stats.xp') %></span
            >
          </div>

          <div
            class="bg-[#1e293b] p-6 rounded-2xl border border-gray-700 flex flex-col items-center justify-center relative overflow-hidden group hover:border-blue-500/50 transition"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition" aria-hidden="true"
            >
              <i class="bx bx-book-open text-6xl text-blue-400"></i>
            </div>
            <span class="text-4xl font-black text-white mb-1"
              ><%= locals.stats ? stats.count : 0 %></span
            >
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest"
              ><%= __('profile.stats.lessons') %></span
            >
          </div>

          <div
            class="bg-[#1e293b] p-6 rounded-2xl border border-gray-700 flex flex-col items-center justify-center relative overflow-hidden group hover:border-purple-500/50 transition"
          >
            <div
              class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition" aria-hidden="true"
            >
              <i class="bx bx-star text-6xl text-purple-400"></i>
            </div>
            <span
              id="profile-level-value"
              class="text-4xl font-black text-white mb-1"
              ><%= user.level || 1 %></span
            >
            <span
              class="text-xs font-bold text-gray-400 uppercase tracking-widest"
              ><%= __('profile.stats.level') %></span
            >
          </div>
        </div>

        <div
          class="bg-[#1e293b] rounded-2xl border border-gray-700 overflow-hidden"
        >
          <div
            class="p-4 border-b border-gray-700 bg-gray-800/30 flex items-center justify-between"
          >
            <h3 class="font-bold text-white flex items-center gap-2">
              <i class="bx bx-history text-[#f59e0b]" aria-hidden="true"></i> <%=
              __('profile.history.title') %>
            </h3>
          </div>

          <div
            class="divide-y divide-gray-700 max-h-64 overflow-y-auto custom-scrollbar"
          >
            <% if (completedLessons.length === 0) { %>
            <div class="p-8 text-center text-gray-500 text-sm">
              <%= __('profile.history.empty') %>
            </div>
            <% } else { %> <% completedLessons.forEach(item => { %> <% if
            (item.lessons) { %>
            <div
              class="p-4 hover:bg-white/5 transition flex items-center justify-between group"
            >
              <div class="flex items-center gap-4">
                <div
                  class="w-10 h-10 rounded-lg bg-[#0f172a] border border-gray-700 flex items-center justify-center text-green-500" aria-hidden="true"
                >
                  <i class="bx bx-check-circle text-xl"></i>
                </div>
                <div>
                  <h4
                    class="text-sm font-bold text-white group-hover:text-[#f59e0b] transition"
                  >
                    <%= item.lessons.title %>
                  </h4>
                  <div class="flex items-center gap-2 text-xs text-gray-500">
                    <span class="capitalize"><%= item.lessons.category %></span>
                    <span aria-hidden="true">â€¢</span>
                    <span
                      ><%= new Date(item.completed_at).toLocaleDateString()
                      %></span
                    >
                  </div>
                </div>
              </div>
              <a
                href="/lectie/<%= item.lessons.id %>"
                class="text-xs bg-gray-700 hover:bg-gray-600 px-3 py-1.5 rounded-lg text-white transition focus:outline-none focus:ring-2 focus:ring-gray-500"
                aria-label="Recapitulare: <%= item.lessons.title %>"
                ><%= __('profile.history.btn_review') %></a
              >
            </div>
            <% } %> <% }) %> <% } %>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-12 pt-10 border-t border-gray-800">
      <div
        class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4"
      >
        <div>
          <h2 class="text-2xl font-bold text-white flex items-center gap-2">
            <i class="bx bx-layer text-[#f59e0b]" aria-hidden="true"></i> <%=
            __('profile.flashcards.title') %>
          </h2>
          <p class="text-sm text-gray-400 mt-1">
            <%= __('profile.flashcards.subtitle') %>
          </p>
        </div>

        <% if (locals.flashcards && flashcards.length > 0) { %>
        <a
          href="/flashcards/practice"
          class="group px-6 py-3 bg-[#a76900] hover:bg-orange-700 text-white font-bold rounded-xl transition shadow-lg shadow-orange-900/20 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-[#f59e0b]"
        >
          <i
            class="bx bx-play-circle text-2xl group-hover:scale-110 transition" aria-hidden="true"
          ></i>
          <%= __('profile.flashcards.btn_practice') %>
        </a>
        <% } %>
      </div>

      <% if (flashcards.length > 0) { %>
      <div
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      >
        <% flashcards.forEach(card => { %>
        <div class="group h-56 w-full [perspective:1000px] cursor-pointer" tabindex="0" role="button" aria-label="Flashcard: <%= card.front %>">
          <div
            class="relative h-full w-full rounded-2xl shadow-lg transition-all duration-500 [transform-style:preserve-3d] group-hover:[transform:rotateY(180deg)] group-focus:[transform:rotateY(180deg)]"
          >
            <div
              class="absolute inset-0 h-full w-full rounded-2xl bg-[#1e293b] border border-gray-700 p-6 flex flex-col items-center justify-center text-center [backface-visibility:hidden]"
            >
              <div class="w-8 h-1 bg-[#f59e0b] rounded-full mb-4"></div>
              <h3 class="text-xl font-bold text-white line-clamp-3">
                <%= card.front %>
              </h3>
              <p
                class="absolute bottom-4 text-[10px] text-gray-500 uppercase tracking-widest font-bold"
              >
                <%= __('profile.flashcards.card_front') %>
              </p>
            </div>
            <div
              class="absolute inset-0 h-full w-full rounded-2xl bg-gradient-to-br from-[#a76900] to-orange-700 p-6 flex flex-col items-center justify-center text-center text-white [transform:rotateY(180deg)] [backface-visibility:hidden]"
            >
              <div
                class="flex-1 flex items-center justify-center overflow-y-auto w-full custom-scrollbar"
              >
                <p class="text-lg font-medium leading-relaxed">
                  <%= card.back %>
                </p>
              </div>
              <button
                onclick="deleteFlashcard('<%= card.id %>', event)"
                class="absolute top-3 right-3 p-2 bg-black/20 hover:bg-black/40 rounded-lg text-white transition focus:outline-none focus:ring-2 focus:ring-white"
                aria-label="<%= __('profile.flashcards.btn_delete') %>"
                title="<%= __('profile.flashcards.btn_delete') %>"
              >
                <i class="bx bx-trash" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <div
        class="flex flex-col items-center justify-center py-16 bg-[#1e293b]/50 rounded-3xl border-2 border-dashed border-gray-700 text-center"
      >
        <div
          class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-4 text-gray-500" aria-hidden="true"
        >
          <i class="bx bx-bookmarks text-3xl"></i>
        </div>
        <h3 class="text-lg font-bold text-white mb-2">
          <%= __('profile.flashcards.empty_title') %>
        </h3>
        <p class="text-gray-400 max-w-md mx-auto mb-6">
          <%= __('profile.flashcards.empty_desc') %>
        </p>
        <a href="/dashboard" class="text-[#f59e0b] font-bold hover:underline focus:outline-none focus:ring-2 focus:ring-[#f59e0b] rounded px-2"
          ><%= __('profile.flashcards.btn_go_lessons') %> &rarr;</a
        >
      </div>
      <% } %>
    </div>
  </div>
</div>

<script>
    const I18N = {
        confirmDelete: "<%= __('js.confirm_delete') %>",
        errorUnknown: "<%= __('js.error_unknown') %>",
        errorNetwork: "<%= __('js.error_network') %>"
    };

    async function deleteFlashcard(id, event) {
        event.stopPropagation();
        if(!confirm(I18N.confirmDelete)) return;
        
        try {
            const res = await fetch(`/api/flashcards/${id}`, { method: 'DELETE' });
            if(res.ok) window.location.reload();
            else alert(I18N.errorUnknown);
        } catch(e) { alert(I18N.errorNetwork); }
    }
</script>
<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
  }
</style>