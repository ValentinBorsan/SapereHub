<div class="flex h-screen bg-[#020617] overflow-hidden font-sans">
  
  <!-- SIDEBAR DESKTOP -->
  <aside class="w-72 bg-[#1e293b]/50 backdrop-blur-xl border-r border-white/5 hidden lg:flex flex-col relative z-20" aria-label="Sidebar">
    <!-- Logo Area -->
    <div class="p-8 flex items-center gap-3">
      <div class="relative w-10 h-10 flex items-center justify-center bg-gradient-to-br from-sapereOrange to-orange-600 rounded-xl shadow-lg shadow-orange-500/20" aria-hidden="true">
        <img src="/images/logo-sapere1.png" class="h-6 w-auto object-contain brightness-0 invert" alt="" />
      </div>
      <div>
        <h1 class="text-xl font-serif font-bold text-white tracking-tight">Sapere<span class="text-sapereOrange">Plus</span></h1>
        <span class="text-[10px] text-gray-400 uppercase tracking-widest font-bold">Dashboard</span>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-4 space-y-2 mt-2">
      <a href="/dashboard" class="flex items-center gap-4 px-4 py-3.5 bg-sapereOrange/10 text-sapereOrange rounded-xl border border-sapereOrange/20 shadow-sm transition group focus:outline-none focus:ring-2 focus:ring-sapereOrange" aria-current="page">
        <i class='bx bxs-dashboard text-xl group-hover:scale-110 transition' aria-hidden="true"></i>
        <span class="font-bold text-sm"><%= __('nav.dashboard') %></span>
      </a>

      <a href="/exercitii" class="flex items-center gap-4 px-4 py-3.5 text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition group focus:outline-none focus:ring-2 focus:ring-sapereOrange">
        <i class='bx bx-brain text-xl group-hover:text-blue-400 transition' aria-hidden="true"></i>
        <span class="font-medium text-sm"><%= __('nav.exercises') %></span>
      </a>

      <% if (user.role === 'admin') { %>
      <div class="pt-6 mt-6 border-t border-white/5">
        <p class="px-4 text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-3">Admin Studio</p>
        <a href="/admin/create" class="flex items-center gap-4 px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition group focus:outline-none focus:ring-2 focus:ring-sapereOrange">
          <div class="w-6 h-6 rounded bg-gray-800 flex items-center justify-center text-xs group-hover:bg-sapereOrange group-hover:text-white transition" aria-hidden="true"><i class='bx bx-plus'></i></div>
          <span class="text-sm">Lec»õie NouƒÉ</span>
        </a>
        <a href="/admin/create-exercise" class="flex items-center gap-4 px-4 py-3 text-gray-400 hover:text-white hover:bg-white/5 rounded-xl transition group focus:outline-none focus:ring-2 focus:ring-sapereOrange">
          <div class="w-6 h-6 rounded bg-gray-800 flex items-center justify-center text-xs group-hover:bg-green-500 group-hover:text-white transition" aria-hidden="true"><i class='bx bx-task'></i></div>
          <span class="text-sm">Exerci»õiu Nou</span>
        </a>
      </div>
      <% } %>
    </nav>

    <!-- User Mini Profile -->
    <div class="p-4 border-t border-white/5 bg-black/20">
      <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-white/5 transition cursor-pointer" role="button" tabindex="0" aria-label="Profil utilizator: <%= user.full_name %>">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white text-sm font-bold shadow-lg ring-2 ring-[#0f172a]" aria-hidden="true">
          <%= user.full_name ? user.full_name.charAt(0).toUpperCase() : 'U' %>
        </div>
        <div class="overflow-hidden">
          <p class="text-sm text-white font-bold truncate"><%= user.full_name %></p>
          <div class="flex items-center gap-2">
             <span class="text-[10px] bg-white/10 px-1.5 rounded text-gray-300"><%= user.role %></span>
             <span class="text-[10px] text-sapereOrange font-bold">Lvl <%= user.level || 1 %></span>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="flex-1 overflow-y-auto relative bg-[#020617] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-[#1e293b] via-[#020617] to-[#020617]">
    
    <!-- Header Mobile (Sticky) -->
    <div class="lg:hidden sticky top-0 z-30 bg-[#0f172a]/80 backdrop-blur-md border-b border-white/5 p-4 flex justify-between items-center">
      <div class="flex items-center gap-2">
          <img src="/images/logo-sapere1.png" class="h-6 w-auto" alt="" />
          <span class="font-bold text-white">Dashboard</span>
      </div>
      <div class="w-8 h-8 rounded-full bg-sapereOrange flex items-center justify-center text-white font-bold text-xs" aria-hidden="true">
          <%= user.full_name ? user.full_name.charAt(0).toUpperCase() : 'U' %>
      </div>
    </div>

    <div class="p-6 lg:p-12 max-w-7xl mx-auto space-y-10 pb-24 lg:pb-10">
      
      <!-- Welcome Section -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
        <div>
          <h1 class="text-3xl md:text-4xl font-bold text-white mb-2 tracking-tight">
            Salut, <span class="text-transparent bg-clip-text bg-gradient-to-r from-sapereOrange to-orange-400"><%= user.full_name.split(' ')[0] %></span>! üëã
          </h1>
          <p class="text-gray-400 text-sm md:text-base"><%= __('dashboard.subtitle') %></p>
        </div>

        <% if (user.role === 'admin') { %>
        <div class="flex gap-3 w-full md:w-auto">
          <a href="/admin/create-lesson" class="flex-1 md:flex-none justify-center px-5 py-3 bg-white/5 hover:bg-white/10 border border-white/10 text-white font-bold rounded-xl transition flex items-center gap-2 text-sm backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-sapereOrange">
            <i class="bx bx-book-add" aria-hidden="true"></i> Lec»õie
          </a>
          <a href="/admin/create-exercise" class="flex-1 md:flex-none justify-center px-6 py-3 bg-sapereOrange hover:bg-orange-600 text-white font-bold rounded-xl transition shadow-lg shadow-orange-500/20 flex items-center gap-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-400">
            <i class="bx bx-task" aria-hidden="true"></i> Exerci»õiu
          </a>
        </div>
        <% } %>
      </div>

      <!-- Stats Grid -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6">
        <!-- Lessons Card -->
        <div class="bg-[#1e293b]/40 backdrop-blur border border-white/5 p-5 rounded-2xl relative overflow-hidden group hover:border-sapereOrange/30 transition duration-300">
          <div class="relative z-10">
             <div class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1"><%= __('dashboard.stats_lessons') %></div>
             <div class="text-3xl font-bold text-white flex items-baseline gap-2">
                 <%= lessons.length %>
                 <span class="text-xs font-normal text-green-400 flex items-center" aria-label="cre»ôtere"><i class='bx bx-up-arrow-alt' aria-hidden="true"></i></span>
             </div>
          </div>
          <i class="bx bx-book-open absolute bottom-4 right-4 text-4xl text-white/5 group-hover:text-white/10 transition" aria-hidden="true"></i>
        </div>

        <!-- Exercises Card -->
        <div class="bg-[#1e293b]/40 backdrop-blur border border-white/5 p-5 rounded-2xl relative overflow-hidden group hover:border-sapereOrange/30 transition duration-300">
          <div class="relative z-10">
             <div class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1"><%= __('dashboard.stats_exercises') %></div>
             <div class="text-3xl font-bold text-sapereOrange flex items-baseline gap-2">
                 <%= typeof exercises !== 'undefined' ? exercises.length : 0 %>
             </div>
          </div>
          <i class="bx bx-dumbbell absolute bottom-4 right-4 text-4xl text-sapereOrange/10 group-hover:text-sapereOrange/20 transition" aria-hidden="true"></i>
        </div>

        <!-- Level Card -->
        <div class="bg-[#1e293b]/40 backdrop-blur border border-white/5 p-5 rounded-2xl relative overflow-hidden group hover:border-sapereOrange/30 transition duration-300">
           <div class="flex items-center justify-between">
               <div>
                   <div class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1"><%= __('profile.stats.level') %></div>
                   <div class="text-3xl font-bold text-purple-400"><%= user.level || 1 %></div>
               </div>
               <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 border border-purple-500/20" aria-hidden="true">
                   <i class='bx bx-trophy text-2xl'></i>
               </div>
           </div>
        </div>

        <!-- XP Card -->
        <div class="bg-[#1e293b]/40 backdrop-blur border border-white/5 p-5 rounded-2xl relative overflow-hidden group hover:border-sapereOrange/30 transition duration-300">
           <div class="flex items-center justify-between">
               <div>
                   <div class="text-gray-400 text-[10px] font-bold uppercase tracking-wider mb-1"><%= __('profile.stats.xp') %></div>
                   <div class="text-3xl font-bold text-green-400"><%= user.xp || 0 %></div>
               </div>
               <div class="w-12 h-12 rounded-xl bg-green-500/10 flex items-center justify-center text-green-400 border border-green-500/20" aria-hidden="true">
                   <i class='bx bx-star text-2xl'></i>
               </div>
           </div>
        </div>
      </div>

      <!-- Library Section -->
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
          
          <!-- Lessons Table -->
          <div class="bg-[#1e293b]/30 border border-white/5 rounded-2xl overflow-hidden shadow-xl flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-[#1e293b]/50">
              <h3 class="text-lg font-bold text-white flex items-center gap-2">
                <span class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-400" aria-hidden="true"><i class="bx bx-book"></i></span>
                <%= __('dashboard.library_lessons') %>
              </h3>
              <a href="/lessons" class="text-xs text-gray-400 hover:text-white transition focus:outline-none focus:underline">Vezi tot -></a>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <caption class="sr-only">ListƒÉ lec»õii disponibile</caption>
                <thead>
                  <tr class="text-gray-500 text-[10px] uppercase font-bold bg-[#0f172a]/30">
                    <th class="px-6 py-4" scope="col"><%= __('dashboard.table.title') %></th>
                    <th class="px-6 py-4" scope="col"><%= __('dashboard.table.category') %></th>
                    <th class="px-6 py-4 text-right" scope="col"><%= __('dashboard.table.actions') %></th>
                  </tr>
                </thead>
                <tbody class="text-sm divide-y divide-white/5">
                  <% if (lessons.length === 0) { %>
                  <tr>
                    <td colspan="3" class="px-6 py-8 text-center text-gray-500 italic"><%= __('dashboard.table.empty_lessons') %></td>
                  </tr>
                  <% } %> 
                  <% lessons.slice(0, 5).forEach(lesson => { %>
                  <tr class="hover:bg-white/5 transition group">
                    <td class="px-6 py-4 font-bold text-gray-200 group-hover:text-white transition truncate max-w-[150px]"><%= lesson.title %></td>
                    <td class="px-6 py-4">
                      <span class="px-2 py-1 rounded text-[10px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20 uppercase"><%= lesson.category %></span>
                    </td>
                    <td class="px-6 py-4 text-right flex justify-end gap-2">
                      <a href="/lectie/<%= lesson.id %>" target="_blank" aria-label="√éncepe lec»õia <%= lesson.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-blue-600 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-blue-500"><i class="bx bx-play" aria-hidden="true"></i></a>
                      <% if (user.role === 'admin') { %>
                      <a href="/admin/create-lesson?edit=<%= lesson.id %>" aria-label="EditeazƒÉ lec»õia <%= lesson.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-sapereOrange rounded-lg transition focus:outline-none focus:ring-2 focus:ring-sapereOrange"><i class="bx bx-edit" aria-hidden="true"></i></a>
                      <button onclick="deleteItem('<%= lesson.id %>', 'lesson')" aria-label="»òterge lec»õia <%= lesson.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-red-500 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-red-500"><i class="bx bx-trash" aria-hidden="true"></i></button>
                      <% } %>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Exercises Table -->
          <% if (typeof exercises !== 'undefined') { %>
          <div class="bg-[#1e293b]/30 border border-white/5 rounded-2xl overflow-hidden shadow-xl flex flex-col">
            <div class="p-6 border-b border-white/5 flex justify-between items-center bg-[#1e293b]/50">
              <h3 class="text-lg font-bold text-white flex items-center gap-2">
                <span class="w-8 h-8 rounded-lg bg-orange-500/10 flex items-center justify-center text-orange-400" aria-hidden="true"><i class="bx bx-dumbbell"></i></span>
                <%= __('dashboard.library_exercises') %>
              </h3>
              <a href="/exercitii" class="text-xs text-gray-400 hover:text-white transition focus:outline-none focus:underline">Vezi tot -></a>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <caption class="sr-only">ListƒÉ exerci»õii disponibile</caption>
                <thead>
                  <tr class="text-gray-500 text-[10px] uppercase font-bold bg-[#0f172a]/30">
                    <th class="px-6 py-4" scope="col"><%= __('dashboard.table.title') %></th>
                    <th class="px-6 py-4" scope="col"><%= __('dashboard.table.difficulty') %></th>
                    <th class="px-6 py-4 text-right" scope="col"><%= __('dashboard.table.actions') %></th>
                  </tr>
                </thead>
                <tbody class="text-sm divide-y divide-white/5">
                  <% if (exercises.length === 0) { %>
                  <tr>
                    <td colspan="3" class="px-6 py-8 text-center text-gray-500 italic"><%= __('dashboard.table.empty_exercises') %></td>
                  </tr>
                  <% } %> 
                  <% exercises.slice(0, 5).forEach(ex => { %>
                  <tr class="hover:bg-white/5 transition group">
                    <td class="px-6 py-4 font-bold text-gray-200 group-hover:text-white transition truncate max-w-[150px]"><%= ex.title %></td>
                    <td class="px-6 py-4">
                      <span class="capitalize text-xs font-bold <%= ex.difficulty === 'usor' ? 'text-green-400' : (ex.difficulty === 'mediu' ? 'text-yellow-400' : 'text-red-400') %>">
                        <%= ex.difficulty %>
                      </span>
                    </td>
                    <td class="px-6 py-4 text-right flex justify-end gap-2">
                      <a href="/exercitii/<%= ex.id %>" target="_blank" aria-label="Porne»ôte exerci»õiul <%= ex.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-green-600 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-green-500"><i class="bx bx-joystick" aria-hidden="true"></i></a>
                      <% if (user.role === 'admin') { %>
                      <a href="/admin/edit-exercise/<%= ex.id %>" aria-label="EditeazƒÉ exerci»õiul <%= ex.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-sapereOrange rounded-lg transition focus:outline-none focus:ring-2 focus:ring-sapereOrange"><i class="bx bx-edit" aria-hidden="true"></i></a>
                      <button onclick="deleteItem('<%= ex.id %>', 'exercise')" aria-label="»òterge exerci»õiul <%= ex.title %>" class="p-2 bg-white/5 text-gray-400 hover:text-white hover:bg-red-500 rounded-lg transition focus:outline-none focus:ring-2 focus:ring-red-500"><i class="bx bx-trash" aria-hidden="true"></i></button>
                      <% } %>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          </div>
          <% } %>

      </div>
    </div>
  </main>


  <!-- MOBILE BOTTOM NAV (Vizibil doar pe mobil) -->
  <div class="lg:hidden fixed bottom-0 left-0 w-full bg-[#1e293b]/95 backdrop-blur-xl border-t border-white/10 z-50 px-6 py-3 flex justify-between items-center safe-area-bottom">
      <a href="/" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition">
          <i class='bx bx-home text-2xl'></i>
          <span class="text-[10px] font-bold">AcasƒÉ</span>
      </a>
      <a href="/dashboard" class="flex flex-col items-center gap-1 text-sapereOrange transition">
          <i class='bx bxs-dashboard text-2xl'></i>
          <span class="text-[10px] font-bold">Dash</span>
      </a>
      <% if (user.role === 'admin') { %>
      <a href="/admin/create-lesson" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition relative -top-5">
          <div class="w-12 h-12 bg-sapereOrange rounded-full flex items-center justify-center text-white shadow-lg shadow-orange-500/30 border-4 border-[#0f172a]">
              <i class='bx bx-plus text-2xl'></i>
          </div>
      </a>
      <% } %>
      <a href="/exercitii" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition">
          <i class='bx bx-brain text-2xl'></i>
          <span class="text-[10px] font-bold">Exerci»õii</span>
      </a>
      <a href="/profile" class="flex flex-col items-center gap-1 text-gray-400 hover:text-white transition">
          <div class="w-6 h-6 rounded-full bg-gray-700 flex items-center justify-center text-[10px] font-bold border border-gray-500"><%= user.full_name ? user.full_name.charAt(0).toUpperCase() : 'U' %></div>
          <span class="text-[10px] font-bold">Profil</span>
      </a>
  </div>

</div>

<script>
  // Traduceri »ôi logicƒÉ de »ôtergere
  const I18N = {
    confirmDelete: "<%= __('js.confirm_delete') %>",
    errorUnknown: "<%= __('js.error_unknown') %>",
    errorNetwork: "<%= __('js.error_network') %>",
  };

  async function deleteItem(id, type) {
    if (!confirm(I18N.confirmDelete)) return;

    let endpoint = "";
    if (type === "exercise") endpoint = `/admin/delete-exercise/${id}`;
    else if (type === "lesson") endpoint = `/admin/delete-lesson/${id}`;

    if (!endpoint) return;

    try {
      const res = await fetch(endpoint, { method: "DELETE" });
      const data = await res.json();

      if (res.ok) {
        window.location.reload();
      } else {
        alert("Eroare: " + (data.error || I18N.errorUnknown));
      }
    } catch (e) {
      console.error(e);
      alert(I18N.errorNetwork);
    }
  }
</script>